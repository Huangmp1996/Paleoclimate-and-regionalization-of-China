---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.13.0
  kernelspec:
    display_name: R
    language: R
    name: ir
---

```{r}
library(png)
library(tidyverse)
library(ragg)
library(ggpubr)
```

```{r}
load('amphibian/amphibian_FD.Rdata')
load('reptile/lizard_FD.Rdata')
load('ave/bird_FD.Rdata')
load('mammal/mammal_FD.Rdata')
load('Fig/nri.Rdata')
```

```{r}
load('ave/bird_fast_slow_cwm.Rdata')
load('mammal/mammal_fast_slow_cwm.Rdata')
```

```{r}
lizard_img <- readPNG('phyloPic/PhyloPic.02811a3f.Gopal-Murali.Lygosominae_Scincidae_Scincoidea_Scincomorpha_Sphenomorphini_Sphenomorphus_Sphenomorphus-dussumieri_Squamata_Unidentata.png')
amphibian_img <- readPNG('phyloPic/PhyloPic.4d1f2d5f.Beth-Reinke.Pelophylax_Pelophylax-perezi_Ranidae.png')
bird_img <- readPNG('phyloPic/PhyloPic.7f02b605.Lauren-Anderson.Gruidae_Gruinae_Grus_Grus-canadensis.png')
mammal_img <- readPNG('phyloPic/PhyloPic.3d259941.Margot-Michaud.Ailuropoda-melanoleuca.png')
```

```{r}
options(repr.plot.width=13, repr.plot.height=12)
fig_FD <- ggpubr::ggarrange(amphibian_FD, lizard_FD, bird_FD, mammal_FD, labels = c("A", "B", "C", "D"),
                             font.label = list(size = 18), ncol = 2, nrow = 2) +
                                annotation_raster(amphibian_img,0.16,0.24,0.56,0.655) +                
                                annotation_raster(lizard_img,0.68,0.74,0.53,0.67) +
                                annotation_raster(bird_img,0.16,0.23,0.08,0.17) +
                                annotation_raster(mammal_img,0.66,0.74,0.08,0.16)
fig_FD
ggsave('Fig/FD.tiff',height = 10,width = 10,units = 'in',dpi = 300)
```

```{r}
options(repr.plot.width=13, repr.plot.height=12)
fig_FV <- ggpubr::ggarrange(amphibian_FV, lizard_FV, bird_FV, mammal_FV, labels = c("A", "B", "C", "D"),
                             font.label = list(size = 18), ncol = 2, nrow = 2) +
                                annotation_raster(amphibian_img,0.16,0.24,0.56,0.655) +                
                                annotation_raster(lizard_img,0.68,0.74,0.53,0.67) +
                                annotation_raster(bird_img,0.16,0.23,0.08,0.17) +
                                annotation_raster(mammal_img,0.66,0.74,0.08,0.16)
fig_FV
ggsave('Fig/FV.tiff',height = 10,width = 10,units = 'in',dpi = 300)
```

```{r}
options(repr.plot.width=13, repr.plot.height=12)
fig_FE <- ggpubr::ggarrange(amphibian_FE, lizard_FE, bird_FE, mammal_FE, labels = c("A", "B", "C", "D"),
                             font.label = list(size = 18), ncol = 2, nrow = 2) +
                                annotation_raster(amphibian_img,0.16,0.24,0.56,0.655) +                
                                annotation_raster(lizard_img,0.68,0.74,0.53,0.67) +
                                annotation_raster(bird_img,0.16,0.23,0.08,0.17) +
                                annotation_raster(mammal_img,0.66,0.74,0.08,0.16)
fig_FE
ggsave('Fig/FE.tiff',height = 10,width = 10,units = 'in',dpi = 300)
```

```{r}
fig_cwm_map <- ggpubr::ggarrange(bird_fast_slow_cwm_map, mammal_fast_slow_cwm_map, 
                             bird_fast_slow_cwm_map_abnormal, mammal_fast_slow_cwm_map_abnormal,
                             font.label = list(size = 18), ncol = 2, nrow = 2, 
                             labels = c("A", "B", "C", "D"))
ggsave('Fig/fig_cwm_map.svg',height = 10,width = 10)
```

```{r}
options(repr.plot.width=14, repr.plot.height=12)
fig_cwm <- ggpubr::ggarrange(bird_pca_var_plot, mammal_pca_var_plot, 
                             bird_cwm_fast_slow, mammal_cwm_fast_slow,
                             font.label = list(size = 18), ncol = 2, nrow = 2, 
                            heights = c(1, 1.3))
fig_cwm <- ggpubr::annotate_figure(fig_cwm, bottom = text_grob('LGM temperature change (\u00B0C)'))
fig_cwm
# ggsave('Fig/cwm.tiff',height = 3,width = 7,device = agg_tiff,units = 'in', scaling = 0.5)
ggsave('Fig/cwm_hex.pdf',height = 10,width = 11,units = 'in', scale = 1.5)
```
